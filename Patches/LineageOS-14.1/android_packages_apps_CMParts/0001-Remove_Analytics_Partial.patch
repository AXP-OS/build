From 3ee3966f3bb2c7cf30e6bf38fd2bbb1b2ece00b3 Mon Sep 17 00:00:00 2001
From: Tad <tad@spotco.us>
Date: Tue, 17 Jan 2017 18:04:09 -0500
Subject: [PATCH] Remove stats

Change-Id: If22fca4b2b641f8b68247ece20441b5cc7724709
---
 AndroidManifest.xml                                |  25 -----
 proguard.flags                                     |   1 -
 res/values/config.xml                              |   3 -
 res/values/strings.xml                             |  22 -----
 res/xml/anonymous_stats.xml                        |  32 -------
 res/xml/parts_catalog.xml                          |   5 -
 res/xml/preview_data.xml                           |  52 -----------
 res/xml/privacy_settings.xml                       |   8 --
 .../cmparts/cmstats/AnonymousStats.java            |  73 ---------------
 src/org/cyanogenmod/cmparts/cmstats/Utilities.java | 102 ---------------------
 10 files changed, 323 deletions(-)
 delete mode 100644 res/xml/anonymous_stats.xml
 delete mode 100644 res/xml/preview_data.xml
 delete mode 100644 src/org/cyanogenmod/cmparts/cmstats/AnonymousStats.java
 delete mode 100644 src/org/cyanogenmod/cmparts/cmstats/Utilities.java

diff --git a/AndroidManifest.xml b/AndroidManifest.xml
index 3c58c3f..914a9df 100644
--- a/AndroidManifest.xml
+++ b/AndroidManifest.xml
@@ -183,31 +183,6 @@
                 android:value="status_bar_settings" />
         </activity-alias>
 
-        <!-- Anonymous Statistics -->
-        <receiver android:name=".cmstats.ReportingServiceManager"
-            android:enabled="true"
-            android:exported="false"
-            android:label="ReportingServiceManager">
-            <intent-filter>
-                <action android:name="android.intent.action.BOOT_COMPLETED" />
-                <action android:name="org.cyanogenmod.cmparts.action.TRIGGER_REPORT_METRICS" />
-            </intent-filter>
-        </receiver>
-
-        <service android:label="ReportingService"
-            android:enabled="true"
-            android:exported="false"
-            android:name=".cmstats.ReportingService">
-        </service>
-
-        <service android:name=".cmstats.StatsUploadJobService"
-                 android:permission="android.permission.BIND_JOB_SERVICE" />
-
-        <service android:name=".cmstats.ReportingService"
-                 android:label="ReportingService"
-                 android:enabled="true"
-                 android:exported="false" />
-
 		<!-- Weather settings -->
         <activity-alias
             android:name=".weather.WeatherServiceSettings"
diff --git a/proguard.flags b/proguard.flags
index 733d5d9..58addff 100644
--- a/proguard.flags
+++ b/proguard.flags
@@ -3,7 +3,6 @@
 -keep class org.cyanogenmod.cmparts.*Picker
 -keep class org.cyanogenmod.cmparts.*Settings
 
--keep class org.cyanogenmod.cmparts.cmstats.*
 -keep class org.cyanogenmod.cmparts.contributors.*
 -keep class org.cyanogenmod.cmparts.hardware.*
 -keep class org.cyanogenmod.cmparts.input.*
diff --git a/res/values/config.xml b/res/values/config.xml
index 2980816..a5729c6 100644
--- a/res/values/config.xml
+++ b/res/values/config.xml
@@ -17,9 +17,6 @@
 
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
 
-    <!-- Metrics server endpoint -->
-    <string name="stats_cm_url">https://stats.lineageos.org/api/v1/stats</string>
-
     <!-- When true, weather options will be displayed in settings dashboard -->
     <bool name="config_showWeatherMenu">true</bool>
 
diff --git a/res/values/strings.xml b/res/values/strings.xml
index c13655e..6891213 100644
--- a/res/values/strings.xml
+++ b/res/values/strings.xml
@@ -482,28 +482,6 @@
                  <b>Total commits:</b> <xliff:g id="total_commits">%2$s</xliff:g><br/><br/>
                  <b>Last update:</b> <xliff:g id="date">%3$s</xliff:g>]]></string>
 
-    <!-- Anonymous Statistics #CM -->
-    <!-- About device screen, list item title. Takes the user to the screen about opting in or out of anonymous statistics. -->
-    <string name="anonymous_statistics_title">LineageOS statistics</string>
-    <string name="anonymous_statistics_summary">Help make LineageOS better by opting into anonymous statistics reporting</string>
-    <string name="anonymous_statistics_warning_title">About</string>
-    <string name="anonymous_statistics_warning">Opting into LineageOS Statistics will allow non-personal data to be submitted to the
-        developers of LineageOS to track unique installations across devices. The information submitted includes an unique identifier,
-        which does not compromise your privacy or personal data. The data is submitted during each boot.\n\nFor an example of the data that is submitted, tap on Preview Data.</string>
-    <string name="enable_reporting_title">Enable reporting</string>
-    <string name="preview_data_title">Preview data</string>
-    <string name="view_stats_title">View stats</string>
-    <string name="anonymous_learn_more">Learn more</string>
-
-    <!-- Anonymous Statistics - Preview -->
-    <string name="preview_id_title">Unique ID</string>
-    <string name="preview_device_title">Device</string>
-    <string name="preview_version_title">Version</string>
-    <string name="preview_country_title">Country</string>
-    <string name="preview_carrier_title">Carrier</string>
-    <string name="stats_collection_title">Stats collection</string>
-    <string name="stats_collection_summary">Allow installation metrics and device statistics to be collected</string>
-
     <!-- Display : Rotation  -->
     <string name="accelerometer_title">Auto-rotate screen</string>
     <string name="display_rotation_title">Rotation settings</string>
diff --git a/res/xml/anonymous_stats.xml b/res/xml/anonymous_stats.xml
deleted file mode 100644
index b29885c..0000000
--- a/res/xml/anonymous_stats.xml
+++ /dev/null
@@ -1,32 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<!-- Copyright (C) 2012 The CyanogenMod Project
-
-     Licensed under the Apache License, Version 2.0 (the "License");
-     you may not use this file except in compliance with the License.
-     You may obtain a copy of the License at
-
-          http://www.apache.org/licenses/LICENSE-2.0
-
-     Unless required by applicable law or agreed to in writing, software
-     distributed under the License is distributed on an "AS IS" BASIS,
-     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-     See the License for the specific language governing permissions and
-     limitations under the License.
--->
-
-<PreferenceScreen
-    xmlns:android="http://schemas.android.com/apk/res/android"
-    android:key="cmstats"
-    android:title="@string/anonymous_statistics_title">
-
-    <cyanogenmod.preference.CMSecureSettingSwitchPreference
-            android:key="stats_collection"
-            android:title="@string/stats_collection_title"
-            android:summary="@string/stats_collection_summary"
-            android:defaultValue="true" />
-
-    <PreferenceScreen
-        android:title="@string/preview_data_title"
-        android:fragment="org.cyanogenmod.cmparts.cmstats.PreviewData" />
-
-</PreferenceScreen>
diff --git a/res/xml/parts_catalog.xml b/res/xml/parts_catalog.xml
index 71328eb..347f8e2 100644
--- a/res/xml/parts_catalog.xml
+++ b/res/xml/parts_catalog.xml
@@ -74,11 +74,6 @@
           android:fragment="org.cyanogenmod.cmparts.statusbar.StatusBarSettings"
           cm:xmlRes="@xml/status_bar_settings" />
 
-    <part android:key="cmstats"
-          android:title="@string/anonymous_statistics_title"
-          android:fragment="org.cyanogenmod.cmparts.cmstats.AnonymousStats"
-          cm:xmlRes="@xml/anonymous_stats" />
-
     <part android:key="power_menu"
           android:title="@string/power_menu_title"
           android:fragment="org.cyanogenmod.cmparts.input.PowerMenuActions"
diff --git a/res/xml/preview_data.xml b/res/xml/preview_data.xml
deleted file mode 100644
index 025524c..0000000
--- a/res/xml/preview_data.xml
+++ /dev/null
@@ -1,52 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<!-- Copyright (C) 2012 The CyanogenMod Project
-
-     Licensed under the Apache License, Version 2.0 (the "License");
-     you may not use this file except in compliance with the License.
-     You may obtain a copy of the License at
-
-          http://www.apache.org/licenses/LICENSE-2.0
-
-     Unless required by applicable law or agreed to in writing, software
-     distributed under the License is distributed on an "AS IS" BASIS,
-     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-     See the License for the specific language governing permissions and
-     limitations under the License.
--->
-
-<PreferenceScreen
-    xmlns:android="http://schemas.android.com/apk/res/android"
-    android:title="@string/preview_data_title">
-
-    <Preference
-        android:key="preview_id"
-        style="?android:preferenceInformationStyle"
-        android:title="@string/preview_id_title"
-        android:summary="%s" />
-
-    <Preference
-        android:key="preview_device"
-        style="?android:preferenceInformationStyle"
-        android:title="@string/preview_device_title"
-        android:summary="%s" />
-
-    <Preference
-        android:key="preview_version"
-        style="?android:preferenceInformationStyle"
-        android:title="@string/preview_version_title"
-        android:summary="%s" />
-
-    <Preference
-        android:key="preview_country"
-        style="?android:preferenceInformationStyle"
-        android:title="@string/preview_country_title"
-        android:summary="%s" />
-
-    <Preference
-        android:key="preview_carrier"
-        style="?android:preferenceInformationStyle"
-        android:title="@string/preview_carrier_title"
-        android:summary="%s" />
-
-</PreferenceScreen>
-
diff --git a/res/xml/privacy_settings.xml b/res/xml/privacy_settings.xml
index 5ae923a..45df2a1 100644
--- a/res/xml/privacy_settings.xml
+++ b/res/xml/privacy_settings.xml
@@ -36,12 +36,4 @@
             android:targetClass="com.android.settings.applications.ProtectedAppsActivity" />
     </Preference>
 
-    <!-- Anonymous statistics - (CMStats) -->
-    <PreferenceScreen
-        android:key="cmstats"
-        android:title="@string/anonymous_statistics_title"
-        android:summary="@string/anonymous_statistics_summary"
-        android:fragment="org.cyanogenmod.cmparts.cmstats.AnonymousStats" >
-    </PreferenceScreen>
-
 </PreferenceScreen>
diff --git a/src/org/cyanogenmod/cmparts/cmstats/AnonymousStats.java b/src/org/cyanogenmod/cmparts/cmstats/AnonymousStats.java
deleted file mode 100644
index 3a6669d..0000000
--- a/src/org/cyanogenmod/cmparts/cmstats/AnonymousStats.java
+++ /dev/null
@@ -1,73 +0,0 @@
-/*
- * Copyright (C) 2015 The CyanogenMod Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.cyanogenmod.cmparts.cmstats;
-
-import android.content.Context;
-import android.content.SharedPreferences;
-import android.os.Bundle;
-
-import org.cyanogenmod.cmparts.R;
-import org.cyanogenmod.cmparts.SettingsPreferenceFragment;
-
-public class AnonymousStats extends SettingsPreferenceFragment {
-
-    private static final String PREF_FILE_NAME = "CMStats";
-    /* package */ static final String ANONYMOUS_OPT_IN = "pref_anonymous_opt_in";
-    /* package */ static final String ANONYMOUS_LAST_CHECKED = "pref_anonymous_checked_in";
-
-    /* package */ static final String KEY_LAST_JOB_ID = "last_job_id";
-    /* package */ static final int QUEUE_MAX_THRESHOLD = 1000;
-
-    public static SharedPreferences getPreferences(Context context) {
-        return context.getSharedPreferences(PREF_FILE_NAME, 0);
-    }
-
-    @Override
-    public void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-        addPreferencesFromResource(R.xml.anonymous_stats);
-    }
-
-    public static void updateLastSynced(Context context) {
-        getPreferences(context)
-                .edit()
-                .putLong(ANONYMOUS_LAST_CHECKED,System.currentTimeMillis())
-                .commit();
-    }
-
-    private static int getLastJobId(Context context) {
-        return getPreferences(context).getInt(KEY_LAST_JOB_ID, 0);
-    }
-
-    private static void setLastJobId(Context context, int id) {
-        getPreferences(context)
-                .edit()
-                .putInt(KEY_LAST_JOB_ID, id)
-                .commit();
-    }
-
-    public static int getNextJobId(Context context) {
-        int lastId = getLastJobId(context);
-        if (lastId >= QUEUE_MAX_THRESHOLD) {
-            lastId = 1;
-        } else {
-            lastId += 1;
-        }
-        setLastJobId(context, lastId);
-        return lastId;
-    }
-}
diff --git a/src/org/cyanogenmod/cmparts/cmstats/Utilities.java b/src/org/cyanogenmod/cmparts/cmstats/Utilities.java
deleted file mode 100644
index efb7379..0000000
--- a/src/org/cyanogenmod/cmparts/cmstats/Utilities.java
+++ /dev/null
@@ -1,102 +0,0 @@
-/*
- * Copyright (C) 2012 The CyanogenMod Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.cyanogenmod.cmparts.cmstats;
-
-import android.content.Context;
-import android.os.Build;
-import android.os.SystemProperties;
-import android.provider.Settings;
-import android.telephony.TelephonyManager;
-import android.text.TextUtils;
-
-import cyanogenmod.providers.CMSettings;
-
-import java.math.BigInteger;
-import java.net.NetworkInterface;
-import java.security.MessageDigest;
-
-public class Utilities {
-    public static String getUniqueID(Context context) {
-        final String id = Settings.Secure.getString(context.getContentResolver(), Settings.Secure.ANDROID_ID);
-        return digest(context.getPackageName() + id);
-    }
-
-    public static String getCarrier(Context context) {
-        TelephonyManager tm = (TelephonyManager) context.getSystemService(Context.TELEPHONY_SERVICE);
-        String carrier = tm.getNetworkOperatorName();
-        if (TextUtils.isEmpty(carrier)) {
-            carrier = "Unknown";
-        }
-        return carrier;
-    }
-
-    public static String getCarrierId(Context context) {
-        TelephonyManager tm = (TelephonyManager) context.getSystemService(Context.TELEPHONY_SERVICE);
-        String carrierId = tm.getNetworkOperator();
-        if (TextUtils.isEmpty(carrierId)) {
-            carrierId = "0";
-        }
-        return carrierId;
-    }
-
-    public static String getCountryCode(Context context) {
-        TelephonyManager tm = (TelephonyManager) context.getSystemService(Context.TELEPHONY_SERVICE);
-        String countryCode = tm.getNetworkCountryIso();
-        if (TextUtils.isEmpty(countryCode)) {
-            countryCode = "Unknown";
-        }
-        return countryCode;
-    }
-
-    public static String getDevice() {
-        return SystemProperties.get("ro.cm.device", Build.PRODUCT);
-    }
-
-    public static String getModVersion() {
-        return SystemProperties.get("ro.cm.version", Build.DISPLAY);
-    }
-
-    public static String digest(String input) {
-        try {
-            MessageDigest md = MessageDigest.getInstance("SHA-256");
-            return new BigInteger(1, md.digest(input.getBytes())).toString(16).toUpperCase();
-        } catch (Exception e) {
-            return null;
-        }
-    }
-
-    /**
-     * Check to see if global stats are enabled.
-     * @param context
-     * @return Whether or not stats collection is enabled.
-     */
-    public static boolean isStatsCollectionEnabled(Context context) {
-        return CMSettings.Secure.getInt(context.getContentResolver(),
-                CMSettings.Secure.STATS_COLLECTION, 1) != 0;
-    }
-
-    /**
-     * Enabled or disable stats collection
-     * @param context
-     * @param enabled Boolean that sets collection being enabled.
-     */
-    public static void setStatsCollectionEnabled(Context context, boolean enabled) {
-        int enable = (enabled) ? 1 : 0;
-        CMSettings.Secure.putInt(context.getContentResolver(),
-                CMSettings.Secure.STATS_COLLECTION, enable);
-    }
-}
-- 
2.9.3

