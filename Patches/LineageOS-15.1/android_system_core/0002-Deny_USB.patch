From 808fb79d8171f26bc29332145df4edac1925e76e Mon Sep 17 00:00:00 2001
From: Daniel Micay <danielmicay@gmail.com>
Date: Sun, 22 Apr 2018 10:18:06 -0400
Subject: [PATCH] add properties for controlling deny_new_usb

Change-Id: I0ead2254b7e379abaeab6f0f78a48680d40a8994
---
 rootdir/init.rc | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/rootdir/init.rc b/rootdir/init.rc
index 2a7333563..aa654c38f 100644
--- a/rootdir/init.rc
+++ b/rootdir/init.rc
@@ -696,6 +696,18 @@ on property:sys.sysctl.extra_free_kbytes=*
 on property:sys.sysctl.tcp_def_init_rwnd=*
     write /proc/sys/net/ipv4/tcp_default_init_rwnd ${sys.sysctl.tcp_def_init_rwnd}
 
+on property:persist.security.deny_new_usb=disabled
+    write /proc/sys/kernel/deny_new_usb 0
+
+on property:persist.security.deny_new_usb=enabled
+    write /proc/sys/kernel/deny_new_usb 1
+
+on property:persist.security.deny_new_usb=dynamic
+    write /proc/sys/kernel/deny_new_usb 1
+
+on property:security.deny_new_usb=*
+    write /proc/sys/kernel/deny_new_usb ${security.deny_new_usb}
+
 on property:security.perf_harden=0
     write /proc/sys/kernel/perf_event_paranoid 1
 
-- 
2.17.0

