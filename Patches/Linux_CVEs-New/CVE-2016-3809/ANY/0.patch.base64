<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Diff - f2152040cb3c13fa846914df1ad44a8a7fd2e935^! - kernel/msm - Git at Google</title><link rel="stylesheet" type="text/css" href="/+static/base.HLL9TqKl0YYybSzmT_wTdw.cache.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="/"><img src="//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?service=gerritcodereview&amp;continue=https://android.googlesource.com/login/kernel/msm/%2B/f2152040cb3c13fa846914df1ad44a8a7fd2e935%255E%2521/">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="/?format=HTML">android</a> / <a class="Breadcrumbs-crumb" href="/kernel/">kernel</a> / <a class="Breadcrumbs-crumb" href="/kernel/msm/">msm</a> / <a class="Breadcrumbs-crumb" href="/kernel/msm/+/f2152040cb3c13fa846914df1ad44a8a7fd2e935%5E%21/">f2152040cb3c13fa846914df1ad44a8a7fd2e935^!</a> / <span class="Breadcrumbs-crumb">.</span></div><div class="u-monospace Metadata"><table><tr><th class="Metadata-title">commit</th><td>f2152040cb3c13fa846914df1ad44a8a7fd2e935</td><td><span>[<a href="/kernel/msm/+log/f2152040cb3c13fa846914df1ad44a8a7fd2e935/">log</a>]</span> <span>[<a href="/kernel/msm/+archive/f2152040cb3c13fa846914df1ad44a8a7fd2e935/.tar.gz">tgz</a>]</span></td></tr><tr><th class="Metadata-title">author</th><td>Mohamad Ayyash &lt;mkayyash@google.com&gt;</td><td>Tue May 24 15:44:24 2016 -0700</td></tr><tr><th class="Metadata-title">committer</th><td>Patrick Tjin &lt;pattjin@google.com&gt;</td><td>Wed Jun 08 09:40:11 2016 -0700</td></tr><tr><th class="Metadata-title">tree</th><td><a href="/kernel/msm/+/f2152040cb3c13fa846914df1ad44a8a7fd2e935/">94cdf0453986ab2673284370ede95824fff017f9</a></td></tr><tr><th class="Metadata-title">parent</th><td><a href="/kernel/msm/+/f2152040cb3c13fa846914df1ad44a8a7fd2e935%5E">4641bdfd4961b71547571a20e664f4831715b651</a> <span>[<a href="/kernel/msm/+/f2152040cb3c13fa846914df1ad44a8a7fd2e935%5E%21/">diff</a>]</span></td></tr></table></div><pre class="u-pre u-monospace MetadataMessage">Don&#39;t show empty tag stats for unprivileged uids

BUG: 27577101
BUG: 27532522
Change-Id: <a href="https://android-review.googlesource.com/#/q/I890831a72e5ad4485fdf30e51a146712b18052ed">I890831a72e5ad4485fdf30e51a146712b18052ed</a>
Signed-off-by: Mohamad Ayyash &lt;mkayyash@google.com
</pre><pre class="u-pre u-monospace Diff"><a name="F0" class="Diff-fileIndex"></a>diff --git <a href="/kernel/msm/+/4641bdfd4961b71547571a20e664f4831715b651/net/netfilter/xt_qtaguid.c">a/net/netfilter/xt_qtaguid.c</a> <a href="/kernel/msm/+/f2152040cb3c13fa846914df1ad44a8a7fd2e935/net/netfilter/xt_qtaguid.c">b/net/netfilter/xt_qtaguid.c</a>
index c690e0f..9ce6228 100644
--- a/net/netfilter/xt_qtaguid.c
+++ b/net/netfilter/xt_qtaguid.c
</pre><pre class="u-pre u-monospace Diff-unified"><span class="Diff-hunk">@@ -2521,7 +2521,7 @@
</span><span class="Diff-change"> 	uid_t stat_uid = get_uid_from_tag(tag);</span>
<span class="Diff-change"> 	struct proc_print_info *ppi = m-&gt;private;</span>
<span class="Diff-change"> 	/* Detailed tags are not available to everybody */</span>
<span class="Diff-delete">-	if (get_atag_from_tag(tag) &amp;&amp; !can_read_other_uid_stats(stat_uid)) {</span>
<span class="Diff-insert">+	if (!can_read_other_uid_stats(stat_uid)) {</span>
<span class="Diff-change"> 		CT_DEBUG(&quot;qtaguid: stats line: &quot;</span>
<span class="Diff-change"> 			 &quot;%s 0x%llx %u: insufficient priv &quot;</span>
<span class="Diff-change"> 			 &quot;from pid=%u tgid=%u uid=%u stats.gid=%u\n&quot;,</span>
</pre></div> <!-- Container --></div> <!-- Site-content --><!-- default customFooter --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="?format=JSON">json</a></span></div></footer></body></html>